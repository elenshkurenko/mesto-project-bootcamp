(()=>{"use strict";function e(e,t,o){var n=t.querySelector(e.submitButtonSelector);!function(e){return e.some((function(e){return!e.validity.valid}))}(o)?(n.classList.remove(e.inactiveButtonClass),n.removeAttribute("disable")):(n.classList.add(e.inactiveButtonClass),n.setAttribute("disable",""))}function t(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",r)}function o(e){e.classList.add("popup_opened"),document.addEventListener("keydown",r)}function n(e){var t=e.querySelector(".popup__form");t&&t.reset()}function r(e){"Escape"===e.key&&t(document.querySelector(".popup_opened"))}function c(e){e.textContent="Сохранение..."}function u(e,t){e.classList.contains("popup_new-place")&&(t.textContent="Создать"),t.textContent="Сохранить"}var a={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-7",headers:{authorization:"73c9eeaa-e096-4c6c-9b04-d0a45e0a4e57","Content-Type":"application/json"}},l=document.querySelectorAll(".popup"),i=document.querySelector(".popup_profile"),s=i.querySelector(".popup__input_type_username"),p=i.querySelector(".popup__input_type_about-user"),_=document.querySelector(".profile"),d=_.querySelector(".profile__username"),f=_.querySelector(".profile__about-user"),y=i.querySelector(".popup__save");function m(e){s.value=e.name,p.value=e.about}l.forEach((function(e){e.addEventListener("click",(function(o){o.target.closest(".popup__wrap")||t(e)}))}));var v=document.querySelector(".popup_new-place"),S=v.querySelector(".popup__input_type_placename"),h=v.querySelector(".popup__input_type_placelink"),q=v.querySelector(".popup__save"),b=document.querySelector(".gallery"),g=document.querySelector("#template-card").content,k=document.querySelector(".popup__open-image"),E=k.querySelector(".popup__image"),L=k.querySelector(".popup__image-title"),C="12284cd080471aa186314a04";function j(e){var t=g.querySelector(".gallery__item").cloneNode(!0),n=t.querySelector(".gallery__image"),r=t.querySelector(".gallery__title"),c=t.querySelector(".gallery__delete-button"),u=e.owner._id===C;return function(e,t){var o=e.querySelector(".gallery__like-button");o.addEventListener("click",(function(){o.classList.contains("gallery__like-button_active")?function(e){return fetch("".concat(a.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(t).then((function(t){x(e,t)})):function(e){return fetch("".concat(a.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(t).then((function(t){x(e,t)})),o.classList.toggle("gallery__like-button_active")}))}(t,e._id),n.src=e.link,n.alt=e.name,r.textContent=e.name,e.likes.some((function(e){return e._id===C}))&&t.querySelector(".gallery__like-button").classList.add("gallery__like-button_active"),x(t,e),function(e,t){e.querySelector(".gallery__delete-button").addEventListener("click",(function(){!function(e){fetch("".concat(a.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(t),e.remove()}))}(t,e._id),function(e){var t=e.querySelector(".gallery__image"),n=e.querySelector(".gallery__title");t.addEventListener("click",(function(){o(k),E.src=t.src,E.alt=n.textContent,L.textContent=n.textContent}))}(t),u||c.remove(),t}function x(e,t){e.querySelector(".gallery__likes").textContent=t.likes.length}var P=document.querySelector(".profile"),A=P.querySelector(".profile__username"),U=P.querySelector(".profile__about-user"),w=P.querySelector(".profile__avatar"),T=document.querySelector(".popup_update-avatar"),B=T.querySelector(".popup__input"),D=T.querySelector(".popup__save");function N(e){A.textContent=e.name,U.textContent=e.about,w.src=e.avatar}var O,H=document.querySelector(".profile"),J=document.querySelector(".popup_profile"),M=H.querySelector(".profile__edit"),z=H.querySelector(".profile__username"),F=H.querySelector(".profile__about-user"),G=H.querySelector(".profile__button"),I=H.querySelector(".profile__edit-avatar"),K=document.querySelectorAll(".popup__close"),Q=J.querySelector(".popup__form"),R=document.querySelector(".popup_new-place"),V=document.querySelector(".popup_update-avatar"),W=R.querySelector(".popup__form"),X=V.querySelector(".popup__form");m({name:z.textContent,about:F.textContent}),M.addEventListener("click",(function(){o(i)})),G.addEventListener("click",(function(){o(R)})),I.addEventListener("click",(function(){return o(V)})),K.forEach((function(e){var o=e.closest(".popup");e.addEventListener("click",(function(){t(o)}))})),X.addEventListener("submit",(function(e){var o;e.preventDefault(),c(D),(o=B.value,fetch("".concat(a.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){u(T,D),N(e)})),n(T),t(T)})),Q.addEventListener("submit",(function(e){e.preventDefault(),c(y),d.textContent=s.value,f.textContent=p.value,function(e,t){fetch("".concat(a.baseUrl,"/users/me"),{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e})).catch((function(e){console.log(e)}))}(s.value,p.value),u(i,y),t(i)})),b.innerHTML="",fetch("".concat(a.baseUrl,"/cards"),{headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).then((function(e){e.forEach((function(e){b.append(j(e))}))})),W.addEventListener("submit",(function(e){var o,r;e.preventDefault(),c(q),(o=S.value,r=h.value,fetch("".concat(a.baseUrl,"/cards"),{method:"POST",headers:a.headers,body:JSON.stringify({name:o,link:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){u(v,q);var t=j(e);b.prepend(t)})),t(v),n(v)})),O={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save",inactiveButtonClass:"popup__save_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},Array.from(document.querySelectorAll(O.formSelector)).forEach((function(t){!function(t,o){var n=Array.from(o.querySelectorAll(t.inputSelector));e(t,o,n),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,o){o.validity.valid?function(e,t,o){var n=t.querySelector(".".concat(o.id,"-error"));o.classList.remove(e.inputErrorClass),n.classList.remove(e.errorClass),n.textContent=""}(e,t,o):function(e,t,o,n){var r=t.querySelector(".".concat(o.id,"-error"));o.classList.add(e.inputErrorClass),r.classList.add(e.errorClass),r.textContent=n}(e,t,o,o.validationMessage)}(t,o,r),e(t,o,n)}))})),o.addEventListener("submit",(function(){e(t,o,n)}))}(O,t)})),fetch("".concat(a.baseUrl,"/users/me"),{headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).then((function(e){N(e),m(e)}))})();